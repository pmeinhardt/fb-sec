<!DOCTYPE html>
<html>
<head prefix="og: http://ogp.me/ns# website: http://ogp.me/ns/website#">
  <meta charset="utf-8">
  <title>clueless-fb</title>
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="stylesheet" href="normalize.min.css">
  <link rel="stylesheet" href="index.css">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://clueless-fb.herokuapp.com/">
  <meta property="og:image" content="https://clueless-fb.herokuapp.com/img/step-0.jpg">
  <meta property="og:title" content="Exchange encrypted Facebook messages">
  <meta property="og:description" content="Don't want facebook to read your private messages? Here's a simple solution.">
</head>
<body>
  <div class="container">
    <div class="hero-unit">
      <h1>clueless-fb</h1>
    </div>
    <div class="keys">
      <p>
        <a id="bookmarklet" href="#" class="bookmark draggable">
          <img src="img/key.png" alt="Secure FB">
        </a>
      </p>
      <p>
        <input id="pubkey" class="pubkey" type="text">
      </p>
    </div>
    <div class="instructions">
      <h2>Usage</h2>
      <ol>
        <li>Install the bookmarklet by dragging the symbol above to the bookmarks bar</li>
        <li>Copy the public key from the text field</li>
        <li>Go to your Facebook profile's <a href="https://www.facebook.com/me/info" target="blank">"About" page</a></li>
        <li>Paste it there, so that others can send you encrypted messages</li>
        <li>Before <a href="https://www.facebook.com/messages/">reading/writing messages on Facebook</a>, click the bookmark</li>
      </ol>
    </div>
    <ol class="steps">
      <li><img src="img/step-0.jpg" title="Install the bookmarklet by dragging it to the bookmarks bar"></li>
      <li><img src="img/step-1.jpg" title="Go to your Facebook 'About' page"></li>
      <li><img src="img/step-2.jpg" title="Paste the public key into the 'Quotations' section of your about page so that others can send you encrypted messages"></li>
      <li><img src="img/step-3.jpg" title=""></li>
      <li><img src="img/step-4.jpg" title=""></li>
    </ol>
    <div class="footer">
      <p>
        <a href="https://github.com/pmeinhardt/clueless-fb">project on github</a> | <a href="http://thenounproject.com/noun/key/#icon-No655">key icon</a>
      </p>
    </div>
  </div>

  <a href="https://github.com/pmeinhardt/clueless-fb"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>

  <script src="/lib/jsbn.js"></script>
  <script src="/lib/jsbn2.js"></script>
  <script src="/lib/prng4.js"></script>
  <script src="/lib/rng.js"></script>
  <script src="/lib/rsa.js"></script>
  <script src="/lib/rsa2.js"></script>

  <script>
    $(function() {
      // Generate a public-private key pair used for asymmetric enryption.
      var keygen = function(options) {
        var key = new RSAKey();
        key.generate(options.bits, options.e);
        return key;
      };

      // Export the public key data from a generated key.
      var pubkey = function(key) {
        var pub = [
          key.n.toString(16),
          key.e.toString(16)
        ].join('|');
        return pub;
      };

      // Export the private key data from a generated key.
      var privkey = function(key) {
        var priv = [
          key.n.toString(16),
          key.e.toString(16),
          key.d.toString(16)
        ].join('|');
        return priv;
      };

      // Encode a string of JavaScript for use as a bookmarklet. See:
      // http://daringfireball.net/2007/03/javascript_bookmarklet_builder
      var bookmarkify = function(script) {
        var bookmark, lines, line, i;
        lines = script.split('\n');
        bookmark = [];
        for (i = 0; i < lines.length; i++) {
          line = lines[i];
          line = line.replace(/\s+\/\/.*$/, ''); // strip comments
          line = line.replace(/\t/g, ' ');       // tabs to one space
          line = line.replace(/ {2,}/g, ' ');    // space runs to one space
          line = line.replace(/^ +/, '');        // trim leading whitespace
          line = line.replace(/ +$/, '');        // trim trailing whitespace
          bookmark.push(line);
        }
        return 'javascript:' + bookmark.join('');
      };

      // Build a fresh new bookmarklet.
      $.get('/clueless-fb.js', function(data) {
        var source, bits, key, $a, $pubkey;

        // Use a shorter key size for local development.
        bits = (window.location.hostname === 'localhost')? 1024 : 2048;

        // Generate a secure public-private key pair. Refer to the README for
        // for documentation on the chosen key generation parameter values.
        key = keygen({
          bits: bits, // 2048 recommended
          e: '10001'  // hex ~> 65537
        });

        // Fill out the bookmarklet template.
        source = data.replace('<public-key>', pubkey(key));
        source = data.replace('<private-key>', privkey(key));

        // Create a bookmark link, which can be dragged to the bookmarks bar.
        $a = $('#bookmarklet');
        $a.attr({href: bookmarkify(source)});

        // Present the public key, for copy-pasting into placeâ€¦
        $pubkey = $('#pubkey');
        $pubkey.val('[[cfbkey:' + pubkey(key) + ']]');
        $pubkey.on('click', function() { $(this).select(); });
      });
    });
  </script>
</body>
</html>
